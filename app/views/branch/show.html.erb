<%= form_with(model: Order.new, url: '../order#create', method: :POST) do |form| %>
  <%= form.hidden_field :branch_id, value: @branch.id %>
  <%= form.hidden_field :total, value: 0 %>

  <div class="row justify-content-center mt-5">
    <div class="card" style="width: 21rem;">
      <% qty = 0 %>
      <div class="form-body py-5">
        <p>
          <%= form.label :username %><br />
          <%= form.text_field :username %>
        </p>
        <h5 class="form-title text-center pb-3">
          <%= @branch.name %> MENU
        </h5>

        <% if @branch.items.any? %>
          <% @branch.items.each do |item| %>
            <% item_details = BranchItemController.get_details(@branch.id, item.id) %>
            <% if item_details.available_qty == 0 %>
              <div class="form-check">
                <%= form.check_box :item_ids, { multiple: true, disabled: true }, item.id, nil %>
                <label class="form-check-label d-block" for="flexCheckDisabled">
                  <div class="row">
                    <div class="col">
                      <%= item.name.capitalize() %>
                    </div>
                    <div class="col">
                      <%= item_details.price.to_s + " SR" %>
                    </div>
                  </div>
                </label>
              </div>
            <% else %>
              <div class="form-check">
                <%= form.check_box :item_ids, { multiple: true }, item.id, nil %>
                <label class="form-check-label d-block" for="flexCheckChecked">
                  <div class="row">
                    <div class="col">
                      <%= item.name.capitalize() %>
                    </div>
                    <div class="col">
                      <%= item_details.price.to_s + " SR" %>
                    </div> 
                    <div class="col">
                        <!-- Nested attributes for the join model -->
                        <%= form.fields_for :order_items, OrderItem.new do |order_item_form| %>
                        <%= order_item_form.hidden_field :item_id, value: item.id %>
                        <%= order_item_form.number_field :qty, placeholder: 'Quantity' %>
                        <%= order_item_form.hidden_field :pric, value: item_details.price %>
                      <% end %>
                    </div>
                  </div>
                </label>
              </div>

            
             <% end %>
            <% end %>
          <% end %>
        

        <div class="text-center pt-3">
          <%= form.submit 'Order Now!', class: 'btn btn-danger rounded-0 mt-2', style: 'width: 10rem;' %>
        </div>
      </div>
    </div>
  </div>
<% end %>
